<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Demo - Mecalux Pallet Detection</title>
  <link rel="stylesheet" href="style.css">
  <style>
    main {
      background-color: #f9f9f9;
      max-width: 85%;
      margin: 60px auto 40px auto;
      padding: 60px 60px;
      border-radius: 12px;
    }

    .fade-in {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeInUp 0.8s ease-out forwards;
    }

    .appear {
      opacity: 1 !important;
      transform: none !important;
    }

    @keyframes fadeInUp {
      to {
        opacity: 1;
        transform: none;
      }
    }

    .subrayado-animado {
      display: inline-block;
      position: relative;
    }

    .subrayado-animado::after {
      content: '';
      position: absolute;
      left: 0;
      bottom: 0;
      width: 100%;
      height: 3px;
      background-color: #004080;
      animation: expandSubrayado 1s ease-out;
    }

    @keyframes expandSubrayado {
      from { width: 0; }
      to { width: 100%; }
    }

    a:hover {
      transform: scale(1.03);
      transition: transform 0.3s ease;
    }
  </style>
</head>
<body>

  <header>
    <div class="header-flex">
      <div class="logo-column">
        <a href="https://www.mecalux.es" target="_blank">
          <img src="mecalux-logo.png" alt="Logo Mecalux" class="logo">
        </a>
        <a href="https://www.upc.edu" target="_blank">
          <img src="upc-logo.png" alt="Logo UPC" class="logo">
        </a>
      </div>
      <div>
        <h1 class="header-title" style="margin-bottom: 2px;">Mecalux Pallet Detection</h1>
        <p style="font-style: italic; color: white; font-size: 0.8em; margin: 0;">
          Sistema automático para la inspección visual de palets y mercancías en tiempo real
        </p>
      </div>
    </div>

    <nav>
      <a href="index.html">¿Qué estamos solucionando?</a>
      <a href="resultados.html">Resultados</a>
      <a href="demo.html">Pruébalo tú mismo</a>
      <a href="modelo.html">Modelo</a>
      <a href="contacto.html">Contacto</a>
    </nav>
  </header>

  <main>
    <h2 class="fade-in subrayado-animado" style="text-align: center;">Prueba el modelo tú mismo</h2>
    <p class="fade-in" style="text-align: center;">
      Puedes acceder a la versión web del modelo a través del siguiente enlace:
    </p>

    <div class="fade-in" style="text-align: center; margin-top: 20px;">
      <a href="https://huggingface.co/spaces/marcrubii/MecaluxPalletDetection"
         target="_blank"
         style="display: inline-block; padding: 15px 30px; background-color: #007bff; color: white; text-decoration: none; font-size: 1.1em; border-radius: 8px;">
        ¡Sube tu imagen o vídeo y pruébalo aquí!
      </a>
    </div>

    <p class="fade-in" style="margin-top: 30px; font-size: 0.95em; color: #555; text-align: center; background-color: #fff8e1; padding: 15px; border-left: 5px solid #ffa000;">
      Recuerda que Hugging Face es un entorno gratuito, por lo que utilizará <strong>CPU</strong>. Las predicciones, especialmente en vídeo, pueden tardar más.<br>
      Además, el modelo no es perfecto y puede fallar en imágenes con mala calidad o paquetes mal centrados. Ha sido diseñado para entornos logísticos controlados.
    </p>

    <hr style="margin: 50px 0;">

    <section class="fade-in" style="text-align: center;">
      <h2 class="subrayado-animado">¡Implementa el modelo tú mismo!</h2>
      <p>Puedes probar el modelo en Google Colab con tus propias imágenes. A continuación puedes descargar los archivos necesarios:</p>

      <div style="max-width: 800px; margin: 0 auto; text-align: left; font-size: 0.95em; background-color: #e6f0fa; padding: 20px; border-radius: 10px; border: 1px solid #004080;">
        <p><strong style="color: #004080;">best.pt</strong>: archivo con los pesos del modelo entrenado.</p>
        <p><strong style="color: #004080;">data.yaml</strong>: archivo de configuración con las clases del dataset.</p>
        <p><strong style="color: #004080;">dataset</strong>: Todas las imágenes que se han usado para entrenar el modelo, incluido <em>data augmentation</em>.</p>
        <p><strong style="color: #004080;">labels</strong>: Archivos de texto que indican las ubicaciones y clases de los objetos anotados en cada imagen.</p>
      </div>

      <div style="margin: 25px 0;">
        <a href="https://drive.google.com/drive/folders/1yK_s-otUTLbObeL3SIaq0vzXZ0NGkkfu?usp=drive_link" 
           target="_blank"
           style="display: inline-block; padding: 15px 35px; background-color: #17a2b8; color: white; text-decoration: none; font-size: 1.1em; border-radius: 8px;">
          Descargar archivos del modelo
        </a>
      </div>

      <details style="max-width: 900px; margin: 0 auto; text-align: left;">
        <summary style="cursor: pointer; font-size: 1.1em; font-weight: bold; margin-bottom: 10px;">
          Ver instrucciones y código para Google Colab
        </summary>
        <pre style="background: #f4f4f4; padding: 20px; border-radius: 8px; font-size: 0.85em; overflow-x: auto;"><code># Instalar ultralytics
!pip install -q ultralytics

# Subir imagenes_nuevas.zip (imágenes que quieras predecir), best.pt y data.yaml
from google.colab import files
uploaded = files.upload()

# Extraer imágenes
!rm -rf /content/imagenes_nuevas/
!mkdir -p /content/imagenes_nuevas
!unzip -oq imagenes_nuevas.zip -d /content/imagenes_nuevas

# Mover imágenes desde subcarpetas
import os, glob, shutil
for ruta in glob.glob('/content/imagenes_nuevas/**/*.*', recursive=True):
    if ruta.lower().endswith(('.jpg', '.jpeg', '.png', '.bmp', '.tif', '.tiff', '.webp')):
        try:
            nombre = os.path.basename(ruta)
            destino = os.path.join('/content/imagenes_nuevas/', nombre)
            if not os.path.samefile(ruta, destino):
                shutil.move(ruta, destino)
        except Exception:
            pass

# Autolabel con best.pt
!yolo detect predict model=best.pt \
  source=/content/imagenes_nuevas \
  save_txt \
  save_conf \
  project=/content/predicciones \
  name=resultados

# Filtrar por confianza ≥ 0.7
ruta_labels = '/content/predicciones/resultados/labels'
filtradas = '/content/predicciones_filtradas'
if os.path.exists(filtradas): shutil.rmtree(filtradas)
os.makedirs(filtradas, exist_ok=True)

for archivo in os.listdir(ruta_labels):
    if archivo.endswith(".txt"):
        ruta = os.path.join(ruta_labels, archivo)
        lineas_filtradas = []
        with open(ruta, 'r') as f:
            for linea in f:
                partes = linea.strip().split()
                if len(partes) > 5 and float(partes[-1]) >= 0.7:
                    lineas_filtradas.append(" ".join(partes[:-1]))
        if lineas_filtradas:
            with open(os.path.join(filtradas, archivo), 'w') as f:
                f.write("\n".join(lineas_filtradas))

# Comprimir y descargar
!zip -qr /content/labels_filtradas.zip /content/predicciones_filtradas
from google.colab import files
files.download('/content/labels_filtradas.zip')</code></pre>
      </details>
    </section>
  </main>

  <footer>
    &copy; 2025 Marc Rubí · Mecalux Pallet Detection
  </footer>

</body>
</html>
